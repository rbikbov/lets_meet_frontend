import{a$ as y,O as M,P as S,r as b,N as C,Q as f,R as o,U as c,B as e,ap as p,S as n,V as x,aY as h,M as k,H as D,aq as F}from"./index.be0786c9.js";import{a as T,s as B}from"./dialogs.daa209f3.js";import{_ as I,V as N}from"./VTextField.9c85025f.js";import{u as $,D as w}from"./keys.abfa1cc6.js";import{u as L}from"./actionCable.b175de01.js";import{u as O}from"./useMutation.esm.a2ac1e92.js";import{V as q}from"./VContainer.0d9e09c0.js";import{g as V}from"./VAvatar.75e0fa98.js";import{a as A,V as Q}from"./VRow.0910e68b.js";import{V as R}from"./VDivider.373e3431.js";import{V as J}from"./VForm.bdcbbd54.js";import{V as P}from"./VCard.8a782045.js";import"./index.5baaf378.js";import"./VProgressCircular.6cfce55a.js";const _=y("messages",()=>{const{accessToken:u}=M(S()),s=b([]);function r(a){s.value=a}return L({accessToken:u}).subscribeToMessagesChannel({received(a){s.value.push(a.message)},connected:(...a)=>console.log("Connected",a)}),{messages:s,setMessages:r}}),te=C({__name:"DialogDetail",props:{dialogId:null},setup(u){const s=u,r=_(),{messages:d}=M(_()),a=$({queryKey:[w,s.dialogId],queryFn:()=>T(s.dialogId),onSuccess:i=>{r.setMessages(i.data)}}),l=b(""),m=O({mutationFn:()=>B(s.dialogId,{text_message:l.value}),onSuccess:i=>{l.value="",r.setMessages([...d.value,i.data])}});return(i,g)=>(c(),f(q,{fluid:""},{default:o(()=>[e(V,{class:"mx-auto mb-4",color:"success",type:"button",variant:"elevated",onClick:n(a).refetch},{default:o(()=>[p(" Fetch dialog messages ")]),_:1},8,["onClick"]),e(A,{dense:""},{default:o(()=>[(c(!0),x(k,null,h(n(d),t=>(c(),f(Q,{key:JSON.stringify(t),cols:"12"},{default:o(()=>[e(P,{title:`${t.user_id} ${t.dialog_id}`,subtitle:`message is ${JSON.stringify(t)}`,text:t.description},null,8,["title","subtitle","text"])]),_:2},1024))),128))]),_:1}),e(R),e(J,{onSubmit:F(n(m).mutate,["prevent"])},{default:o(()=>[e(I,null,{default:o(({inputProps:t})=>[e(N,D(t,{modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=v=>l.value=v),readonly:n(m).isLoading.value,class:"mt-4",clearable:"",label:"Message",type:"text"}),null,16,["modelValue","readonly"])]),_:1}),e(V,{loading:n(m).isLoading.value,type:"submit"},{default:o(()=>[p(" Send Message ")]),_:1},8,["loading"])]),_:1},8,["onSubmit"])]),_:1}))}});export{te as default};
