---
openapi: 3.0.1
info:
  title: API V1
  version: v1
paths:
  "/api/v1/cities":
    get:
      summary: return cities by country
      tags:
      - Cities
      parameters:
      - name: country
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Found
          content:
            application/json:
              schema:
                type: array
                items: {}
  "/api/v1/cities/country":
    get:
      summary: return all countries
      tags:
      - Cities
      responses:
        '200':
          description: Found
          content:
            application/json:
              schema:
                type: object
  "/api/v1/dialogs/{id}/send_message":
    post:
      summary: creates message
      tags:
      - Dialogs
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/message"
        '403':
          description: Forbidden
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Access denied
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                text_message:
                  type: string
              required:
              - text_message
  "/api/v1/users/{id}/dialogs":
    get:
      summary: return dialogs
      tags:
      - Dialogs
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Found
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/dialogs_array"
        '403':
          description: Forbidden
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Access denied
  "/api/v1/dialogs/{id}":
    get:
      summary: return dialog
      tags:
      - Dialogs
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Found
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/dialog"
        '403':
          description: Forbidden
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Access denied
  "/api/v1/dialogs/{id}/messages":
    get:
      summary: return dialog messages
      tags:
      - Dialogs
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Found
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/messages_array"
        '403':
          description: Forbidden
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Access denied
  "/api/v1/meets":
    get:
      summary: Search persons
      tags:
      - Meets
      parameters:
      - name: search
        in: query
        schema:
          type: object
          properties:
            age_min:
              type: integer
            age_max:
              type: integer
            gender:
              "$ref": "#/components/schemas/gender_type"
            city:
              type: string
            page:
              type: integer
            per:
              type: integer
        required:
        - search
      responses:
        '200':
          description: Found
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/users_array"
  "/api/v1/meets/{id}/like_person":
    post:
      summary: likes person
      tags:
      - Meets
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Found
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: You're liked this person!
        '403':
          description: Forbidden
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Access denied
  "/api/v1/meets/{id}/confirm":
    post:
      summary: likes person
      tags:
      - Meets
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Found
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Dialog opened
        '403':
          description: Forbidden
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Access denied
  "/api/v1/users/{id}/notifications":
    get:
      summary: return notifications
      tags:
      - Notifications
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Found
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/notifications_array"
        '403':
          description: Forbidden
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Access denied
  "/api/v1/sessions":
    post:
      summary: Creates a session
      tags:
      - Sessions
      parameters: []
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/access_token"
        '400':
          description: Bad request
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Something went wrong, please try again
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  "$ref": "#/components/schemas/signin_request_data_user"
              required:
              - user
  "/api/v1/sessions/refresh":
    post:
      summary: Refresh session
      tags:
      - Sessions
      parameters: []
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/access_token"
        '400':
          description: Bad request
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Something went wrong. Please try again
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
              required:
              - token
  "/api/v1/sessions/logout":
    delete:
      summary: Delete session
      tags:
      - Sessions
      responses:
        '204':
          description: No content
        '400':
          description: Bad request
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Something went wrong. Please try again
  "/api/v1/users":
    post:
      summary: Creates a user
      tags:
      - Users
      parameters: []
      responses:
        '201':
          description: Created
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: You're registered successfully
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    "$ref": "#/components/schemas/invalid_user"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  "$ref": "#/components/schemas/signup_request_data_user"
    get:
      summary: Return users list
      tags:
      - Users
      responses:
        '200':
          description: Found
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/users_array"
  "/api/v1/users/resend_confirmation":
    post:
      summary: Resend confirmation mail
      tags:
      - Users
      parameters: []
      responses:
        '201':
          description: Created
          content:
            application/json:
              examples:
                example_1:
                  value:
                    type: object
                    properties:
                      message: Confirmation mail sended again!
        '400':
          description: Bad request
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Something went wrong, please try again
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
              required:
              - email
  "/api/v1/users/{id}":
    get:
      summary: Return user
      tags:
      - Users
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Found
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/user"
        '400':
          description: Bad request
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Something went wrong, please try again
    patch:
      summary: Update user
      tags:
      - Users
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Found
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/me"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                profile:
                  "$ref": "#/components/schemas/profile_data_user"
  "/api/v1/users/{id}/confirm_account":
    get:
      summary: Confirm account
      tags:
      - Users
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Found
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Welcome to the Sample App! Your email has been confirmed
        '400':
          description: Bad request
          content:
            application/json:
              examples:
                example_1:
                  value:
                    message: Something went wrong, please try again
  "/api/v1/users/me":
    get:
      summary: Return current user
      tags:
      - Users
      responses:
        '200':
          description: Found
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/me"
        '401':
          description: Unauthorized
  "/api/v1/users/{id}/load_avatar":
    patch:
      summary: Load user avatar
      tags:
      - Users
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Found
          content:
            application/json:
              schema:
                type: object
                "$ref": "#/components/schemas/me"
      requestBody:
        content:
          multipart/form-data:
            schema:
              "$ref": "#/components/schemas/avatar_file"
              encoding:
                avatar:
                  contentType:
                  - image/png
                  - image/jpeg
servers:
- url: http://{defaultHost}
  variables:
    defaultHost:
      default: localhost:3000
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    id_number:
      type: integer
    gender_type:
      type: string
      enum:
      - male
      - female
    notification_type:
      type: string
      enum:
      - system
      - like
      - confirm
      - visited
      - mutuality
    jwt_payload:
      type: object
      properties:
        id:
          "$ref": "#/components/schemas/id_number"
        email:
          type: string
          format: email
        admin:
          type: boolean
        salt:
          type: string
        expires_in:
          type: string
          format: date-time
      required:
      - id
      - email
      - admin
      - salt
      - expires_in
    signin_request_data_user:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
      required:
      - email
      - password
    signup_request_data_user:
      allOf:
      - "$ref": "#/components/schemas/signin_request_data_user"
      - type: object
        properties:
          password_confirmation:
            type: string
            format: password
          first_name:
            type: string
        required:
        - password_confirmation
        - first_name
    profile_data_user:
      type: object
      properties:
        first_name:
          type: string
        last_name:
          type: string
        age:
          type: integer
        gender:
          "$ref": "#/components/schemas/gender_type"
      required:
      - first_name
    avatar_file:
      type: object
      properties:
        avatar:
          type: file
    user:
      type: object
      properties:
        id:
          "$ref": "#/components/schemas/id_number"
        first_name:
          type: string
        last_name:
          type: string
        age:
          type: integer
        gender:
          "$ref": "#/components/schemas/gender_type"
        avatar:
          type: string
        likes:
          type: array
          items:
            "$ref": "#/components/schemas/id_number"
      required:
      - id
      - created_at
      - updated_at
      - first_name
    me:
      allOf:
      - "$ref": "#/components/schemas/user"
      - type: object
        properties:
          email:
            type: string
            format: email
        required:
        - email
    invalid_user:
      type: object
      properties:
        email:
          type: array
          items:
            type: string
        password:
          type: array
          items:
            type: string
    access_token:
      type: object
      properties:
        user_id:
          "$ref": "#/components/schemas/id_number"
        token:
          type: string
        expires_in:
          type: string
          format: date-time
        refresh:
          type: string
      required:
      - user_id
      - token
      - expires_in
      - refresh
    dialog:
      type: object
      properties:
        id:
          "$ref": "#/components/schemas/id_number"
        incoming_id:
          "$ref": "#/components/schemas/id_number"
        outgoing_id:
          "$ref": "#/components/schemas/id_number"
        confirmed:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        users:
          "$ref": "#/components/schemas/users_array"
        last_message:
          "$ref": "#/components/schemas/message"
      required:
      - incoming_id
      - outgoing_id
      - users
      - id
    message:
      type: object
      properties:
        id:
          "$ref": "#/components/schemas/id_number"
        dialog_id:
          "$ref": "#/components/schemas/id_number"
        user_id:
          "$ref": "#/components/schemas/id_number"
        description:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
      - id
      - dialog_id
      - user_id
      - description
      - created_at
      - updated_at
    notification:
      type: object
      properties:
        user_id:
          "$ref": "#/components/schemas/id_number"
        content:
          type: object
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        notification_type:
          "$ref": "#/components/schemas/notification_type"
    users_array:
      type: array
      items:
        "$ref": "#/components/schemas/user"
    dialogs_array:
      type: array
      items:
        "$ref": "#/components/schemas/dialog"
    messages_array:
      type: array
      items:
        "$ref": "#/components/schemas/message"
    notifications_array:
      type: array
      items:
        "$ref": "#/components/schemas/notification"
security:
- bearerAuth: []
